<!-- Loading State -->
<div *ngIf="isLoading" class="d-flex justify-content-center align-items-center py-5">
  <div class="text-center">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">{{ 'loading.spinner' | translate }}</span>
    </div>
    <p class="mt-3 text-muted fs-5">{{ 'loading.searchingBuses' | translate }}</p>
    <small class="text-muted">{{ 'loading.mayTakeTime' | translate }}</small>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!isLoading && isEmpty" class="text-center py-5">
  <div class="mb-4">
    <i class="bi bi-bus-front fa-3x text-muted mb-3" style="font-size: 4rem;"></i>
    <h4 class="text-muted mb-3">{{ 'empty.noBuses' | translate }}</h4>
    <p class="text-muted mb-4">
      {{ 'empty.noResults' | translate }}<br>
      {{ 'empty.tryAgain' | translate }}
    </p>
  </div>
</div>

<!-- Highway Badge -->
<div class="highwayPatch text-center" *ngIf="item.highWayDirectRoute === 'Highway'">
  {{ 'badge.highway' | translate }}
</div>

<!-- Available Seats -->
<p>
  <span *ngIf="item.amenities"></span>
  <span *ngFor="let amenity of getAmenityArray(item.amenities)"
        [innerHTML]="(amenity?.toString() || '') | displayAmenity"></span> â€¢
  <span *ngIf="item.available_seat_count">
    {{ 'bus.availableSeats' | translate }} :
    <span class="fw-bold text-primary-emphasis">{{item.available_seat_count}}</span>
  </span>
</p>

<!-- Seat Selection Drawer -->
<p-drawer header="{{ 'drawer.seatSelection' | translate }}"
          [(visible)]="visibleState[i]"
          position="bottom"
          (onHide)="toggleCollapse(i)"
          [style]="{ height: '800px' }">

  <!-- Loading seats -->
  <div *ngIf="isLoadingSeats[i]" class="d-flex justify-content-center align-items-center py-5" style="height: 800px">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status" style="width: 2.5rem; height: 2.5rem;">
        <span class="visually-hidden">{{ 'loading.seatsSpinner' | translate }}</span>
      </div>
      <p class="mt-3 text-muted">{{ 'loading.seats' | translate }}</p>
      <small class="text-muted">{{ 'loading.seatsWait' | translate }}</small>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="!isLoadingSeats[i] && seatLoadError[i]" class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
      <h5 class="text-muted mt-3">{{ 'error.loadSeatsTitle' | translate }}</h5>
      <p class="text-muted">{{ 'error.loadSeatsMessage' | translate }}</p>
      <button class="btn btn-outline-primary" (click)="reloadSeats(item, i)">
        <i class="bi bi-arrow-clockwise me-2"></i>
        {{ 'error.tryAgain' | translate }}
      </button>
    </div>
  </div>

  <!-- Close button -->
  <div class="text-end pb-2 mt-3">
    <button
      class="btn btn-sm btn-outline-secondary bg-secondary-subtle d-flex align-items-center rounded-3 text-dark"
      (click)="toggleCollapse(i)">
      <i class="bi bi-chevron-bar-up me-1"></i>
      {{ 'button.close' | translate }}
    </button>
  </div>
</p-drawer>
