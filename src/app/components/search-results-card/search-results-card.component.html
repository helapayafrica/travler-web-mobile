

<div *ngFor="let item of buses; let i = index">
  <div
    (click)="getSelectedBus(item)"
    [ngClass]="collapseState[i] ? 'bg-white' : 'card-selected'"
    class="d-flex flex-column d-md-none p-3 card rounded-3 shadow-sm m-2 position-relative "
    style="min-width:300px">

    <!-- Highway Badge -->
    <div class="highwayPatch text-center" *ngIf="item.highWayDirectRoute === 'Highway'">Highway</div>


    <!-- Main Content Container -->
    <div class="d-flex flex-column gap-2">
      <img src="assets/logo.png" height="112.5" width="75"
           [ngClass]=" item.highWayDirectRoute === 'Highway' ? 'ms-4':''"
           class="img-thumbnail border-0  text-end" alt="logo">
      <!-- Time and Price Row -->
      <div class="d-flex justify-content-between align-items-start pt-2">
        <!-- Time Section -->
        <div>
          <div class="d-flex align-items-center gap-2 mb-1">
            <span style="font-size: 15px" class="fw-semibold mb-0 text-dark">{{ item.departure_time }}</span>
            <span class="text-muted mx-2">—</span>
            <span style="font-size: 15px" class="mb-0 text-muted">{{ item.arrival_time }}</span>
          </div>
          <div class="text-muted small">
            <span *ngFor="let schedule of item.defaultTripPriceList; let last = last">
              ({{ schedule.amount | number }} {{ schedule.seatType }}{{ !last ? ', ' : '' }})
            </span>
          </div>
        </div>
        <!-- Price Section -->
        <div class="text-end">
          <div class="h5 fw-bold mb-0 text-dark">
            <span style="font-size: 10px; margin-right:4px">KSH</span>
            {{ getPreferredAmount(item) | number }}
          </div>
          <div class="small mb-1">
            {{ getPreferredSeat(item)?.seatType }}
          </div>
        </div>
      </div>



        <!-- Company Info Row -->
      <div class="d-flex justify-content-between align-items-center">
        <!-- Company Details -->
        <div class="d-flex align-items-center">
          <div>
            <div class="d-flex align-items-center gap-2 mb-1">
              <span class="fw-semibold text-dark" style="font-size: 14px">{{ item.bus_title }}</span>
              <span *ngIf="item.verified" class="text-success">
                <i class="fas fa-shield-check" style="font-size: 14px"></i>
              </span>
            </div>
            <div class="small text-muted">
              {{ item.highWayDirectRoute }} • {{ item.busType || 'A/C Sleeper' }}
              <span *ngIf="item.amenities?.length" class="ms-1">({{ item.amenities.length }}+)</span>
            </div>
          </div>
        </div>

        <!-- Rating -->
        <div class="d-flex align-items-center gap-1">
          <span class="badge text-white d-flex align-items-center gap-1 px-2 py-1"
                style="background-color: #28a745; border-radius: 4px">
            ★ {{ item.avg_rating || '4.3' }}
          </span>
        </div>
      </div>

      <!-- Action Button -->
      <div class="d-flex justify-content-end">
        <button
          (click)="toggleCollapse(i);searchSeats(item);$event.stopPropagation()"
          [attr.aria-expanded]="!collapseState[i]"
          [ngClass]="collapseState[i] ? 'btn-primary' : 'btn-outline-secondary'"
          class="btn btn-sm px-4">
          {{ collapseState[i] ? 'View Seats' : 'Close' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Collapsible Section (Closed by Default) -->
<!--  <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseState[i]" class="m-1 col-12 d-lg-none">-->
<!--    <div class="rounded">-->
<!--      <div class="row g-3">-->
<!--        <div class="col-12 ">-->
<!--          <div class="">-->
<!--            <app-component-bus-seat-selector [payload]="seat_data"  [type]="type"></app-component-bus-seat-selector>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="text-end pb-2">-->
<!--        <button class="btn btn-sm btn-outline-primary" (click)="toggleCollapse(i)">-->
<!--          <i class="bi bi-chevron-bar-up me-1"></i>-->
<!--          <span>Close</span>-->
<!--        </button>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--Drawer TRY-->
  <p-drawer header="Seat Selection"
            [(visible)]="visibleState[i]"
            position="bottom"
            (onHide)="toggleCollapse(i)"
            [style]="{ height: '800px' }">
    <div style="overflow-x: hidden; overflow-y: scroll; " class="py-4">
      <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseState[i]" class="m-1 col-12 d-lg-none">
        <div class="rounded">
          <div class="row g-3 mx-0">
            <div class="col-12">
              <div>
                <app-component-bus-seat-selector [payload]="seat_data" [type]="type"></app-component-bus-seat-selector>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>


    <div class="text-end pb-2 my-4">
      <button class="btn btn-sm btn-outline-primary" (click)="toggleCollapse(i)">
        <i class="bi bi-chevron-bar-up me-1"></i>
        <span>Close</span>
      </button>
    </div>
  </p-drawer>
</div>
