<div class="bg-white" *ngFor="let item of buses; let i = index;">

<!--  OG Card-->
<!--  <div-->
<!--    (click)="getSelectedBus(item);"-->
<!--    class="bus-schedule-card" [ngClass]="collapseState[i] ? '' : 'card-selected'">-->
<!--    <div class="highwayPatch text-center" *ngIf="item.highWayDirectRoute === 'Highway'">Highway</div>-->
<!--    <div class="company-info">-->
<!--      <div class="logo-section">-->
<!--        <img [src]="item.company_logo" alt="Bus Company Logo" class="company-logo">-->

<!--        <div class="mobile-details d-flex flex-column d-lg-none align-items-start">-->
<!--          <div class="time-row flex-column gap-0">-->
<!--            <div class="departure-time">{{ item.departure_time}}</div>-->
<!--            <div class="seats-available">{{ item.available_seat_count }} Seat(s)</div>-->
<!--          </div>-->
<!--          <div class="rating-stars">-->
<!--            <span *ngFor="let star of getRatingArray(item.rating)"-->
<!--                  class="star"-->
<!--                  [class.filled]="star">-->
<!--              ★-->
<!--            </span>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="schedule-details">-->
<!--        <div class="company-name">-->
<!--          <h3>{{ item.company_name }}</h3>-->
<!--          <p class="bus-type"> Bus Type: {{ item.highWayDirectRoute }}</p>-->
<!--        </div>-->

<!--        <div class="amenities" *ngIf="item.amenities?.length">-->
<!--          &lt;!&ndash; <span class="amenity" *ngFor="let amenity of item.amenities">-->
<!--            <i class="amenity-icon" [ngClass]="getAmenityIcon(amenity)"></i>-->
<!--          </span> &ndash;&gt;-->
<!--          <span class="more-amenities">+3 Amenities</span>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="time-section d-none d-lg-flex">-->
<!--      <div class="line-container" [style.height.px]="60">-->
<!--        <div class="dot top"></div>-->
<!--        <div class="dotted-line"></div>-->
<!--        <div class="dot bottom"></div>-->
<!--      </div>-->
<!--      <div class="times">-->
<!--        <div class="time departure">{{ item.departure_time }}</div>-->
<!--        <div class="time arrival">{{ item.arrival_time }}</div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="rating-section d-none d-lg-flex flex-column">-->
<!--      <small class="rating-label">RATING</small>-->
<!--      <div class="stars">-->
<!--        <span *ngFor="let star of getRatingArray(item.avg_rating)"-->

<!--              class="star"-->
<!--              [class.filled]="star">-->
<!--          ★-->
<!--        </span>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="d-flex flex-column flex-lg-row">-->
<!--      <div class="pricing-section">-->
<!--        <div *ngFor="let schedule of item.defaultTripPriceList">-->
<!--          <div class="price-category" *ngIf="schedule?.seatType == 'vip'">-->
<!--            <span class="category">Vip:</span>-->
<!--            <span class="amount">KES {{ schedule.amount | number }}</span>-->
<!--          </div>-->
<!--          <div class="price-category" *ngIf="schedule?.seatType == 'business'">-->
<!--            <span class="category">Business:</span>-->
<!--            <span class="amount">KES {{ schedule.amount | number }}</span>-->
<!--          </div>-->
<!--          <div class="price-category" *ngIf="schedule?.seatType == 'normal'">-->
<!--            <span class="category">Normal:</span>-->
<!--            <span class="amount">KES {{ schedule.amount | number }}</span>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="seats-section d-none d-lg-block">-->
<!--        <p class="seats-available">{{ item.available_seat_count }} Seats Available</p>-->
<!--        <button-->
<!--          [ngClass]="collapseState[i] ? 'btn-primary' :'btn-danger'"-->
<!--          class="btn  btn-sm" (click)="toggleCollapse(i);searchSeats(item)"-->
<!--                [attr.aria-expanded]="!collapseState[i]">-->
<!--          <i class="small bi" [ngClass]="collapseState[i] ? 'bi-chevron-up' : 'bi-chevron-down'"></i>-->
<!--          {{ collapseState[i] ? 'View Seats' : 'Close' }}-->
<!--        </button>-->
<!--      </div>-->

<!--      <div class="view-seats-mobile d-block d-lg-none">-->
<!--        <button-->
<!--          [ngClass]="collapseState[i] ? 'btn-primary' :'btn-danger'"-->
<!--          class="btn btn-primary btn-view-seats btn-sm" (click)="toggleCollapse(i);searchSeats(item)"-->
<!--                [attr.aria-expanded]="!collapseState[i]">-->
<!--          {{ collapseState[i] ? 'View Seats' : 'Close' }}-->
<!--        </button>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <-->


<!--   my card -->
  <div
    (click)="getSelectedBus(item);"
    style="min-width:300px;"
    class="d-flex flex-column d-md-none justify-content-between p-3 card rounded-4 shadow m-2"
    [ngClass]="collapseState[i] ? '' : 'card-selected'">

    <!-- Highway Badge -->
    <div class="highwayPatch text-center" *ngIf="item.highWayDirectRoute === 'Highway'">Highway</div>

    <!-- Top Row: Time & Seats -->
    <div class="d-flex flex-row justify-content-between">
      <div class="d-flex flex-column">
        <!-- Badge(s) -->
        <div class="d-flex flex-row gap-2 mb-2">
          <div class="badge bg-warning-subtle text-warning-emphasis">Bus Type: {{ item.highWayDirectRoute }}</div>
        </div>

<!--        <p class="pb-0 mb-0 text-muted small">-->
<!--          {{ item.origin }} ➡️ {{ item.destination }}-->
<!--        </p>-->

        <!-- Time -->
        <p class="fw-semibold mb-1 mt-2">
          <span class="fw-semibold" style="font-size: medium;">{{ item.departure_time }}</span> ---
          <span style="font-size: medium;">{{ item.arrival_time }}</span>
        </p>

        <div class="badge text-primary bg-success-subtle">{{ item.available_seat_count }} seats available</div>
      </div>

      <!-- Price -->
      <div class="d-flex flex-row gap-2 mt-5">
        <div *ngFor="let schedule of item.defaultTripPriceList">
          <div *ngIf="schedule?.seatType == 'vip'">
            <span class="fw-semibold d-block">{{ schedule.amount | number }}</span>
            <span class="text-muted small">VIP</span>
          </div>
          <div *ngIf="schedule?.seatType == 'normal'">
            <span class="fw-semibold d-block">{{ schedule.amount | number }}</span>
            <span class="text-muted small">Normal</span>
          </div>
          <div *ngIf="schedule?.seatType == 'business'">
            <span class="fw-semibold d-block">{{ schedule.amount | number }}</span>
            <span class="text-muted small">Business</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Middle Row: Location and Rating -->
    <div class="d-flex flex-row justify-content-between mt-2">
      <!-- Location -->
      <div class="d-flex flex-row align-items-center p-2 rounded">
        <img height="50" width="50" alt="logo" [src]="item.company_logo" class="me-2" />
        <div class="d-flex flex-column">
          <p class="fw-semibold mb-0" style="font-size:14px;">{{ item.company_name }}</p>
          <p class="text-primary fw-medium mb-0" style="font-size: 13px;" *ngIf="item.amenities?.length">
            Amenities + {{ item.amenities.length }}
          </p>
        </div>
      </div>

      <!-- Rating -->
      <div class="d-flex flex-column align-items-end">
        <div class="rating-stars">
          <span *ngFor="let star of getRatingArray(item.avg_rating)"
                class="star"
                [class.filled]="star">
            ⭐
          </span>
        </div>
      </div>
    </div>

    <!-- Bottom Row: Banner and Button -->
    <div class="d-flex flex-row justify-content-end mt-2">
      <button
        [ngClass]="collapseState[i] ? 'btn-primary' :'btn-danger'"
        class="btn btn-sm"
        (click)="toggleCollapse(i);searchSeats(item)"
        [attr.aria-expanded]="!collapseState[i]">
        {{ collapseState[i] ? 'View Seats' : 'Close' }}
      </button>
    </div>
  </div>

  <!-- Large/Medium devices -->
  <div class="card rounded-4 d-none d-md-block shadow p-3 w-100  m-2"
       (click)="getSelectedBus(item);"
       [ngClass]="collapseState[i] ? '' : 'card-selected'">

    <!-- Highway Badge -->
    <div class="highwayPatch text-center" *ngIf="item.highWayDirectRoute === 'Highway'">Highway</div>

    <!-- Wrap in responsive flex -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3">

      <!-- Left section (time, seats, badges) -->
      <div class="d-flex flex-column">
        <!-- Badge(s) -->
        <div class="d-flex flex-row gap-2 mb-2">
          <div class="badge bg-warning-subtle text-warning-emphasis">Bus Type: {{ item.highWayDirectRoute }}</div>
          <div class="badge bg-success">{{ item.available_seat_count }} seats available</div>
        </div>

<!--        &lt;!&ndash; Route &ndash;&gt;-->
<!--        <p class="pb-0 mb-0 text-muted small">-->
<!--          {{ item.origin }} ➡️ {{ item.destination }}-->
<!--        </p>-->

        <!-- Time -->
        <p class="fw-semibold mb-1">
          <span class="fw-semibold" style="font-size:medium;">{{ item.departure_time }}</span> ---
          <span style="font-size:medium;">{{ item.arrival_time }}</span>
        </p>
        <p class="text-primary fw-medium mb-0" style="font-size: 13px;">{{ item.available_seat_count }} seats</p>
      </div>

      <!-- Middle section (logo + operator info) -->
      <div class="d-flex flex-row align-items-center p-2 rounded">
        <img height="50" width="50" alt="logo" [src]="item.company_logo" class="me-2" />
        <div class="d-flex flex-column">
          <p class="fw-semibold mb-0" style="font-size:14px;">{{ item.company_name }}</p>
          <p class="text-primary fw-medium mb-0" style="font-size: 13px;" *ngIf="item.amenities?.length">
            Amenities + {{ item.amenities.length }}
          </p>
        </div>
      </div>

      <!-- Right section (price + rating + button) -->
      <div class="d-flex flex-column align-items-md-end">
        <!-- Price -->
        <div class="d-flex flex-row gap-4">
          <div *ngFor="let schedule of item.defaultTripPriceList">
            <div *ngIf="schedule?.seatType == 'vip'">
              <span class="fw-semibold d-block">KES {{ schedule.amount | number }}</span>
              <span class="text-muted small">VIP</span>
            </div>
            <div *ngIf="schedule?.seatType == 'normal'">
              <span class="fw-semibold d-block">KES {{ schedule.amount | number }}</span>
              <span class="text-muted small">Normal</span>
            </div>
            <div *ngIf="schedule?.seatType == 'business'">
              <span class="fw-semibold d-block">KES {{ schedule.amount | number }}</span>
              <span class="text-muted small">Business</span>
            </div>
          </div>
        </div>

        <!-- Rating -->
        <div class="rating-stars mt-2 mb-2">
          <span *ngFor="let star of getRatingArray(item.avg_rating)"
                class="star"
                [class.filled]="star">
            ⭐
          </span>
        </div>

        <!-- Button -->
        <button
          [ngClass]="collapseState[i] ? 'btn-primary' :'btn-danger'"
          class="btn btn-sm"
          (click)="toggleCollapse(i);searchSeats(item)"
          [attr.aria-expanded]="!collapseState[i]">
          <i class="small bi" [ngClass]="collapseState[i] ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
          {{ collapseState[i] ? 'View Seats' : 'Close' }}
        </button>
      </div>
    </div>
  </div>










  <!-- Collapsible Section (Closed by Default) -->
   <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseState[i]" class="m-1 col-12 d-lg-none">
    <div class="rounded">
      <div class="row g-3">
        <div class="col-12 ">
          <div class="">
            <app-component-bus-seat-selector [payload]="seat_data"  [type]="type"></app-component-bus-seat-selector>
          </div>
        </div>
      </div>

      <div class="text-end pb-2">
        <button class="btn btn-sm btn-outline-primary" (click)="toggleCollapse(i)">
          <i class="bi bi-chevron-bar-up me-1"></i>
          <span>Close</span>
        </button>
      </div>
    </div>
  </div>
</div>
