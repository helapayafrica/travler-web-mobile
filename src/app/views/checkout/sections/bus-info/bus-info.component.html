<!--<! red buss one &ndash;&gt;-->
<div *ngIf="data.ticketDetail.onwardticket" class="card shadow-sm rounded-3 mb-3">
  <div class="card-body">
    <h5 class="text-danger fw-bold mb-1"> {{data.ticketDetail.onwardticket.company_name }}</h5>
    <small class="text-muted">
      {{data.ticketDetail.onwardticket.company_title }}
    </small>
    <hr class="m-0 mb-1 text-muted">

    <div class="">
      <p class="fw-bold text-dark fs-6">Onward Trip</p>
    </div>

    <!-- Departure + Arrival + Fare -->
    <div class="row mt-3 ">
      <div class="col-6  ">
        <p class="mb-1 text-muted">Departure</p>
        <p class="fw-bold mb-0">{{data.ticketDetail.onwardticket.departure_time || '--:--'}}</p>
      </div>
      <div class="col-6 text-end">
        <p class="mb-1 text-muted">Arrival</p>
        <p class="fw-bold mb-0">{{data.ticketDetail.onwardticket.arrival_time || '--:--'}}</p>
      </div>
    </div>
    <!-- Source + Destination -->
    <div class="row mt-3">
      <div class="col">
        <small class="text-muted">Boarding Point</small>
        <br>
        <i class="bi bi-geo-alt-fill me-2 text-danger"></i>
        <span class="fw-bold">{{data.ticketDetail.onwardticket.source_city}}</span><br>
        <span class="fw-normal text-mutes">{{data.ticketDetail.onwardticket.boardingPointname}}</span><br>
      </div>
      <div class="col text-end">
        <small class="text-muted">Dropping Point</small>
        <br>
        <i class="bi bi-geo-alt-fill me-2 text-success"></i>
        <span class="fw-bold">{{data.ticketDetail.onwardticket.dest_city}}</span><br>
        <span class="fw-normal text-mutes">{{data.ticketDetail.onwardticket.droppingPointname}}</span><br>
      </div>
    </div>
  </div>
  <div class="card-footer border-0 bg-success-subtle">
    <div class="col-12  text-start">
      <p class="mb-1 fw-bold fs-6 text-success-emphasis d-flex align-items-baseline">
        <img class="img-fluid me-2" src="assets/images/seat.png" height="20" width="20" alt="">
        Selected Seats:
        {{ getSelectedSeats() }}
      </p>
    </div>
  </div>
</div>

<!-- Return Trip -->
<div *ngIf="!isObjectEmpty(data?.ticketDetail?.returnticket)" class="card shadow-sm rounded-3 mb-3">
  <div class="card-body">
    <h5 class="text-danger fw-bold mb-1">{{data.ticketDetail.returnticket.company_name}}</h5>
    <small class="text-muted">
      {{data.ticketDetail.returnticket.company_title}}
    </small>
    <hr class="m-0 mb-1 text-muted">

    <div class="">
      <p class="fw-bold text-dark fs-6">Return Trip</p>
    </div>

    <!-- Departure + Arrival -->
    <div class="row mt-3">
      <div class="col-6">
        <p class="mb-1 text-muted">Departure</p>
        <p class="fw-bold mb-0">{{data.ticketDetail.returnticket.departure_time || '--:--'}}</p>
      </div>
      <div class="col-6 text-end">
        <p class="mb-1 text-muted">Arrival</p>
        <p class="fw-bold mb-0">{{data.ticketDetail.returnticket.arrival_time || '--:--'}}</p>
      </div>
    </div>

    <!-- Source + Destination -->
    <div class="row mt-3">
      <div class="col">
        <small class="text-muted">Boarding Point</small><br>
        <i class="bi bi-geo-alt-fill me-2 text-danger"></i>
        <span class="fw-bold">{{data.ticketDetail.returnticket.source_city}}</span><br>
        <span class="fw-normal text-muted">{{data.ticketDetail.returnticket.boardingPointname}}</span><br>
      </div>
      <div class="col text-end">
        <small class="text-muted">Dropping Point</small><br>
        <i class="bi bi-geo-alt-fill me-2 text-success"></i>
        <span class="fw-bold">{{data.ticketDetail.returnticket.dest_city}}</span><br>
        <span class="fw-normal text-muted">{{data.ticketDetail.returnticket.droppingPointname}}</span><br>
      </div>
    </div>
  </div>
  <div class="card-footer border-0 bg-success-subtle">
    <div class="col-12 text-start">
      <p class="mb-1 fw-bold fs-6 text-success-emphasis d-flex align-items-baseline">
        <img class="img-fluid me-2" src="assets/images/seat.png" height="20" width="20" alt="">
        Selected Seats:
        {{ getSelectedSeats() }}
      </p>
    </div>
  </div>
</div>

<!-- Fare Breakup -->
<div class="card shadow-sm rounded-3">
  <div class="card-body p-3">
    <h6 class="text-danger fw-bold">FARE BREAKUP</h6>
    @if (onwardSeatsSummary.length > 0) {
      <p class=" fw-bold  mb-0 pb-0   text-muted text-underline ">Onward Journey</p>
      <hr class="m-0 mb-2 text-muted">
      @for ( seat of onwardSeatsSummary; track  $index) {
        <div class=" ms-3 d-flex justify-content-between mb-0">
          <p class="mb-1">{{seat.total_number + '  ' }}{{seat.seat_type}}</p>
          <p class="fw-medium mb-1  text-muted small">KES {{seat.total_price| number}}</p>
        </div>
      }
    }

    <div class="d-flex justify-content-between">
      <p class="mb-1 fw-semibold">Onward Fare</p>
      <p class="fw-semibold mb-1">KES {{data.ticketDetail.onwardticket.total | number}}</p>
    </div>

    <div *ngIf="!isObjectEmpty(data?.ticketDetail?.returnticket)" class="d-flex justify-content-between mt-3">
      <p class=" fw-bold  mb-1 p-0   text-muted text-underline ">Return Journey</p>
    </div>
    <hr class="m-0 mb-2 text-muted" *ngIf="!isObjectEmpty(data?.ticketDetail?.returnticket)">

    @if (!isObjectEmpty(data?.ticketDetail?.returnticket)) {
      @for ( seat of returnSeatsSummary; track  $index) {
        <div class=" ms-3 d-flex justify-content-between mb-0">
          <p class="mb-1">{{seat.total_number + '  ' }}{{seat.seat_type}}</p>
          <p class="fw-medium mb-1  text-muted small">KES {{seat.total_price| number}}</p>
        </div>
      }

      <div class="d-flex justify-content-between">
        <p class="mb-1 fw-semibold">Return Fare</p>
        <p class="fw-semibold mb-1">KES {{data.ticketDetail.returnticket.total | number}}</p>
      </div>
    }

    <div class=" mt-3">
      <p class=" fw-bold  mb-1 p-0  text-muted text-underline ">Additional Fees</p>
    </div>
    <hr class="m-0 mb-2 text-muted">

    <!-- Direct service access for insurance -->
    <div class="d-flex justify-content-between">
      <p class="mb-1">
        Insurance
        <small class="text-muted" *ngIf="cancellationInsuredService.protectedPassengersCount() > 0">
          ({{ cancellationInsuredService.protectedPassengersCount() }} passengers)
        </small>
      </p>
      <p class="fw-semibold mb-1"
         [ngClass]="{'text-success': cancellationInsuredService.insuranceCost() > 0}">
        KES {{ cancellationInsuredService.insuranceCost() | number }}
      </p>
    </div>

    <!-- Direct service access for cancellation protection -->
    <div class="d-flex justify-content-between">
      <p class="mb-1">
        Cancellation Protect
        <small class="text-muted" *ngIf="cancellationInsuredService.isCancellationProtection()">
          ({{ cancellationInsuredService.passengerCount() }} passengers)
        </small>
        <i class="bi bi-shield-check text-success ms-1"
           *ngIf="cancellationInsuredService.isCancellationProtection()"></i>
      </p>
      <p class="fw-semibold mb-1"
         [ngClass]="{'text-success': cancellationInsuredService.cancellationCost() > 0}">
        KES {{ cancellationInsuredService.cancellationCost() | number }}
      </p>
    </div>

    <div class="d-flex justify-content-between">
      <p class="mb-1">Platform Fees</p>
      <p class="fw-semibold mb-1">KES {{ platformFee | number }}</p>
    </div>

    <div class="d-flex justify-content-between">
      <p class="mb-1">Discount</p>
      <p class="fw-semibold mb-1 text-success">- KES {{ discount | number }}</p>
    </div>
  </div>

  <div class="card-footer border-0 bg-success-subtle">
    <div class="col-12">
      <div class="d-flex justify-content-between">
        <p class="mb-1 fw-bold">Total Payable</p>
        <!-- Final total including platform fee and discount -->
        <p class="fw-bold mb-1">KES {{ getFinalTotal() | number:'1.2-2' }}</p>
      </div>


    </div>
  </div>
</div>


