<div class="card mb-3">
  <div class="card-header border-0">
    <h5 class="card-title fw-semibold">Personal information</h5>

    <!-- Stack vertically on sm, stay horizontal from md up -->
    <div class="d-flex flex-column flex-md-row gap-1 text-center text-md-start">
      <p class="mb-0 small">Do you need help? call us</p>
      <a href="mailto:info@iabiri.com"
         class="fw-medium text-decoration-none ms-md-2">
        +254709215215 | Email: {{ email }}
      </a>
    </div>
  </div>

  <div class="card-body border-0">
    <form #passegerForm="ngForm" class="gap-3">
      <!-- Cancellation Fee -->
      <div class="col-12 col-md-8 col-lg-6 mb-3">
        <div class="d-flex justify-content-between align-items-center rounded-2 bg-custom shadow-sm py-1 px-3">
          <div class=" p-2">
            <div class="d-flex flex-column">
              <p class="mb-0 fw-bold">Cancellation protect</p>
              <p class="mb-0 text-dark">KSH 50 per passenger</p>
            </div>
          </div>
          <div class="form-check form-switch">
            <input
              (change)="updateCancellationProtection($event)"
              [ngModel]="protectionInsuranceService.isCancellationProtection()"
              class="form-check-input custom-switch"
              id="cancellationSwitch"
              name="cancellationSwitch"
              type="checkbox"
            >
          </div>
        </div>
      </div>

      <div *ngFor="let item of data?.ticketDetail.onwardticket?.passenger;let index=index" class="row ">

        <div class="col-sm-8">
          <h5>
            <span *ngIf="index == 0" style="color:green;font-weight: 800;text-transform: uppercase;font-size: 15px;">Primary Passenger</span>
            <span *ngIf="index > 0" style="color:black;font-weight: 800;text-transform: uppercase;font-size: 15px;">Co Passenger</span>
          </h5>
        </div>
        <div class="col-sm-4" style="text-align:right; font-size: 0.875rem;">
          <img alt="Seat Icon" class="mb-2 me-2" height="20" src="/assets/images/seat.png" width="20">
          Seat :<b class="fw-semibold">{{ item.seat_name }}</b>
          <b *ngIf="data?.returnticket?.passenger"
             class="fw-semibold">, {{ data.returnticket.passenger[index].seat_name }}</b>
        </div>
        <div class="col-8 ">
          <label class="form-label" for="firstName">Name</label>
          <input [(ngModel)]="item.name" class="form-control" id="name" name="seat{{item.seat_name}}" placeholder="Name"
                 required type="text">
        </div>
        <div class="col-4">
          <label class="form-label" for="lastName">Age</label>
          <input [(ngModel)]="item.age" class="form-control" id="age" name="age{{item.seat_name}}" placeholder="Age"
                 required  type="number">
        </div>

        <div class="col-4 mt-2">
          <label class="form-label" for="sortBy">Gender</label>
          <select [(ngModel)]="item.gender" class="form-select" id="gender" name="gender{{item.seat_name}}" required>
            <option value="F">Female</option>
            <option value="M">Male</option>
          </select>
        </div>


        <div class="col-8 mt-2">
          <label class="form-label" for="idNo">ID/Passport</label>
          <input [(ngModel)]="item.id_no" class="form-control" name="id_no{{item.seat_name}}" placeholder="ID Number"
                 required
                 type="number">
        </div>
        <div class="col-12 mt-2">
          <label class="form-label" for="idNo">Email</label>
          <input [(ngModel)]="item.email" class="form-control" name="eamil{{item.seat_name}}" placeholder="Email"
                 required email
                 type="text">
        </div>

        <div class="col-12 mt-2">
          <label class="form-label" for="residence">Nationality</label>
          <input [(ngModel)]="item.nationality" [typeaheadOptionField]="'value'" [typeahead]="nationalities"
                 class="form-control"
                 name="nationality{{item.seat_name}}"
                 placeholder="Nationality"
                 required
                 type="text">
        </div>

        <div class="col-12 mt-2">
          <div class="row mb-2">
            <div class="col-4">
              <label class="form-label" for="price">Code</label>
              <select [(ngModel)]="item.mobileId" class="form-select" name="mobileId{{item.seat_name}}" value="+254"
                      required>
                <option *ngFor="let item of country_codes" [value]="item.code"> +{{ item.code }}</option>
              </select>
            </div>
            <div class="col-8">
              <label class="form-label" for="phone_number">Phone Number</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-telephone-plus"></i></span>
                <input
                  [(ngModel)]="item.mobile"
                  class="form-control"
                  name="phone{{item.seat_name}}" placeholder="Phone" placeholder="700000000"
                  required
                  type="number">
              </div>

            </div>
          </div>
        </div>

        <div class=" card -d-flex flex-column gap-3 p-3   ">
          <p class="fw-bold fs-4  mb-0">Travel Insurance</p>
          <p class="mb-0"> Protect your journey with Comprehensive travel insurance</p>

          <div class="d-flex flex-column ">
            <!-- No-insurance option -->
            <label
              class="row custom-bg rounded-4 p-3 mb-3"
              [ngClass]="{ 'border border-primary': getSelectedInsurance(index) === 'none' }"
            >
              <div class="col-11">
                <p class="mb-0 fw-normal">I don't want insurance</p>
              </div>
              <div class="col-1 d-flex justify-content-center align-items-center">
                <input type="radio"
                       name="insurance"  [name]="'insurance-passenger-' + index"        class="form-check-input custom-check"
                       value="none"
                (change)="onSelectNone(index)"
                [checked]="getSelectedInsurance(index) === 'none'"/>

              </div>
            </label>

            <label
              class="row custom-bg rounded-4 p-2 mb-3"
              *ngFor="let ins of travelInsurances"
              [ngClass]="{ 'border border-primary': getSelectedInsurance(index) === ins.name }"
            >
              <div class="col-11">
                <div class="d-flex flex-column">
                  <div class="d-flex flex-row justify-content-between">
                    <p
                      style="font-size: 18px; font-weight: 500"
                      class="bg-info-emphasis fw-semibold mb-0">{{ ins.name }}</p>
                    <p
                      style="font-size: 18px; font-weight: 500"
                      class="bg-info-emphasis fw-semibold mb-0">
                      KES {{ ins.price }}
                    </p>
                  </div>

                  <div class="d-flex flex-row">
                    <p class="mb-0 small">{{ ins.description }}</p>

                    <!-- pass the clicked insurer to the dialog -->
                    <p
                      class="mb-0  custom-btn flex-shrink-0"
                      (click)="showDialog(ins)"
                    >
                      benefits
                    </p>
                  </div>
                </div>
              </div>

              <div class="col-1 d-flex justify-content-center align-items-center">
                <input type="radio"
                       [name]="'insurance-passenger-' + index"
                       class="form-check-input custom-check"
                       [value]="ins.name"
                       (change)="onSelect(ins.name, index)"
                       [checked]="getSelectedInsurance(index) === ins.name" />
              </div>
            </label>

            <!-- Single dialog reused for whichever insurer is selected -->
            <p-dialog
              header="{{ selectedInsurance?.name }} Benefits"
              [modal]="true"
              [(visible)]="dialog"
              [style]="{ width: '25rem' }"
            >
              <ul class="list-disc pl-6 mb-6 text-sm">
                <li *ngFor="let b of selectedInsurance?.benefits">{{ b }}</li>
              </ul>

              <div class="flex justify-end gap-2">
                <p-button label="Close" severity="secondary" (click)="dialog = false"/>
              </div>
            </p-dialog>
          </div>

        </div>

      </div>
    </form>
  </div>
  <div *ngIf="!isSuccess" class="card-footer border-0 text-end">
    <button (click)="proceed()" [disabled]="passegerForm.invalid" class="btn btn-primary py-2 px-3 rounded-pill">Proceed
      to pay
    </button>
  </div>
</div>

<!--unsurance Dialog-->
