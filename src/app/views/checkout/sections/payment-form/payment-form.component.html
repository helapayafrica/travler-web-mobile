<!--<div class="section">-->
<!--  <div class="container app-container">-->
<!--    <div class="section-title mt-4">-->
<!--      <h5 class="fw-bold">MAKE PAYMENTS</h5>-->
<!--    </div>-->

<!--    <div class="row g-4 align-items-start">-->

<!--      &lt;!&ndash; Left Column: Payment Details &ndash;&gt;-->
<!--      <div class="col-12 col-lg-8">-->
<!--        <div class="card shadow-sm border-0 rounded-3 p-4 h-100">-->
<!--          <div>-->

<!--            &lt;!&ndash; Title + Timer &ndash;&gt;-->
<!--            <div class="d-flex justify-content-between align-items-center mb-4">-->
<!--              <h4 class="fw-bold mb-0">Payment Details</h4>-->
<!--              <span class="badge bg-danger text-white rounded-pill px-3 py-2 small">-->
<!--                ⏱ {{ formattedTime }} Remaining-->
<!--              </span>-->
<!--            </div>-->

<!--            <form [formGroup]="paymentForm" class="needs-validation">-->

<!--              &lt;!&ndash; Payment Method &ndash;&gt;-->
<!--              <div class="mb-4">-->
<!--                <label class="form-label fw-semibold">Select Payment Method</label>-->
<!--                <div class="d-flex gap-3">-->
<!--                  &lt;!&ndash; Mpesa &ndash;&gt;-->
<!--                  <label class="flex-fill border rounded-3 p-2 text-center cursor-pointer"-->
<!--                         [ngClass]="{'border-success bg-light': paymentForm.value.paymentMethod === 'mpesa'}">-->
<!--                    <input class="d-none" type="radio" formControlName="paymentMethod" id="mpesa"-->
<!--                           value="mpesa" (change)="updatePlaceholder()">-->
<!--                    <img src="assets/mpesa.png" alt="Mpesa" width="80" class="mb-1"><br>-->
<!--                    <span class="fw-bold small">Mpesa</span>-->
<!--                  </label>-->

<!--                  &lt;!&ndash; Airtel &ndash;&gt;-->
<!--                  <label class="flex-fill border rounded-3 p-2 text-center cursor-pointer"-->
<!--                         [ngClass]="{'border-danger bg-light': paymentForm.value.paymentMethod === 'airtel'}">-->
<!--                    <input class="d-none" type="radio" formControlName="paymentMethod" id="airtel"-->
<!--                           value="airtel" (change)="updatePlaceholder()">-->
<!--                    <img src="assets/airtel.png" alt="Airtel Money" width="80" class="mb-1"><br>-->
<!--                    <span class="fw-bold small">Airtel Money</span>-->
<!--                  </label>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Phone Number &ndash;&gt;-->
<!--              <div class="mb-4">-->
<!--                <label class="form-label fw-semibold">Phone Number</label>-->
<!--                <div class="input-group">-->
<!--                  <select class="form-select flex-shrink-0" style="max-width: 110px;"-->
<!--                          formControlName="countryCode" (change)="updateValidation()">-->
<!--                    <option value="">+Code</option>-->
<!--                    <option *ngFor="let code of countryCodes" [value]="code.code">-->
<!--                      +{{ code.code }}-->
<!--                    </option>-->
<!--                  </select>-->
<!--                  <input type="tel" class="form-control"-->
<!--                         placeholder="700 000 000"-->
<!--                         formControlName="mobileNumber">-->
<!--                </div>-->
<!--                <div class="invalid-feedback"-->
<!--                     *ngIf="paymentForm.get('mobileNumber')?.invalid && paymentForm.get('mobileNumber')?.touched">-->
<!--                  Please enter a valid mobile number.-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Voucher (collapsible) &ndash;&gt;-->
<!--              <div class="mb-4">-->
<!--                <a class="text-decoration-none small text-primary"-->
<!--                   data-bs-toggle="collapse" href="#voucherCollapse">-->
<!--                  Have a voucher?-->
<!--                </a>-->
<!--                <div id="voucherCollapse" class="collapse mt-2">-->
<!--                  <div class="input-group">-->
<!--                    <input type="text" class="form-control rounded-2"-->
<!--                           formControlName="countryCode" placeholder="Voucher code">-->
<!--                    <button class="btn btn-outline-success rounded-2" type="button">Apply</button>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Note &ndash;&gt;-->
<!--              <div class="alert alert-warning d-flex align-items-center py-2">-->
<!--                <i class="bi bi-exclamation-triangle-fill me-2"></i>-->
<!--                <span class="small">-->
<!--                  <strong>Note:</strong> Once seats are selected and paid for,-->
<!--                  tickets are <b>non-refundable</b>.-->
<!--                </span>-->
<!--              </div>-->

<!--              &lt;!&ndash; Consent &ndash;&gt;-->
<!--              <div class="form-check mb-4 small">-->
<!--                <input class="form-check-input" type="checkbox"-->
<!--                       formControlName="consent" id="consentCheck">-->
<!--                <label class="form-check-label" for="consentCheck">-->
<!--                  By proceeding, I consent to iabiri collecting and storing my information-->
<!--                  in accordance with the-->
<!--                  <a href="#" target="_blank">Privacy Policy</a> and-->
<!--                  <a href="#" target="_blank">Terms & Conditions</a>.-->
<!--                </label>-->
<!--              </div>-->

<!--              &lt;!&ndash; Submit &ndash;&gt;-->
<!--              <div class="d-flex justify-content-end">-->
<!--                <button class="btn btn-success py-2 px-4 rounded-pill fs-6 fw-semibold shadow"-->
<!--                        [disabled]="isTimeExpired || paymentForm.invalid"-->
<!--                        (click)="submitPayment()">-->
<!--                  <i class="bi bi-lock-fill me-2"></i>-->
<!--                  Pay Securely with {{ paymentForm.value.paymentMethod | titlecase }}-->
<!--                </button>-->
<!--              </div>-->

<!--            </form>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; Right Column: Bus Info &ndash;&gt;-->
<!--      <div class="col-12 col-lg-4">-->
<!--        <app-checkout-bus-info></app-checkout-bus-info>-->
<!--      </div>-->

<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<div class="section">
  <div class="container">
    <div class="section-title mt-4">
      <h6 class="fw-bolder text-center">TICKET CHECKOUT</h6>
    </div>

    <div class="text-end mb-2">
      <p-button
        label="View Bus Info"
        icon="bi bi-info-circle"
        (click)="busInfoVisible = true"
        styleClass="bg-custom p-button-sm mt-2">
      </p-button>
    </div>



    <div class="row app-container">
      <!-- Left side: booking form -->
      <div class="col-12 col-md-6 col-lg-8 vstack gap-2">
        <div class="card shadow-sm border-0 rounded-3 p-4 h-100">
          <div>

            <!-- Title + Timer -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h4 class="fw-bold mb-0">Payment Details</h4>
              <span class="badge bg-danger text-white rounded-pill px-3 py-2 small">
                ⏱ {{ formattedTime }} Remaining
              </span>
            </div>

            <form [formGroup]="paymentForm" class="needs-validation">

              <!-- Payment Method -->
              <div class="mb-4">
                <label class="form-label fw-semibold">Select Payment Method</label>
                <div class="d-flex gap-3">
                  <!-- Mpesa -->
                  <label class="flex-fill border rounded-3 p-2 text-center cursor-pointer"
                         [ngClass]="{'border-success bg-light': paymentForm.value.paymentMethod === 'mpesa'}">
                    <input class="d-none" type="radio" formControlName="paymentMethod" id="mpesa"
                           value="mpesa" (change)="updatePlaceholder()">
                    <img src="assets/mpesa.png" alt="Mpesa" width="80" class="mb-1"><br>
                    <span class="fw-bold small">Mpesa</span>
                  </label>

                  <!-- Airtel -->
                  <label class="flex-fill border rounded-3 p-2 text-center cursor-pointer"
                         [ngClass]="{'border-danger bg-light': paymentForm.value.paymentMethod === 'airtel'}">
                    <input class="d-none" type="radio" formControlName="paymentMethod" id="airtel"
                           value="airtel" (change)="updatePlaceholder()">
                    <img src="assets/airtel.png" alt="Airtel Money" width="80" class="mb-1"><br>
                    <span class="fw-bold small">Airtel Money</span>
                  </label>
                </div>
              </div>

              <!-- Phone Number -->
              <div class="mb-4">
                <label class="form-label fw-semibold">Phone Number</label>
                <div class="input-group">
                  <select class="form-select flex-shrink-0" style="max-width: 110px;"
                          formControlName="countryCode" (change)="updateValidation()">
                    <option value="">+Code</option>
                    <option *ngFor="let code of countryCodes" [value]="code.code">
                      +{{ code.code }}
                    </option>
                  </select>
                  <input type="tel" class="form-control"
                         placeholder="700 000 000"
                         formControlName="mobileNumber">
                </div>
                <div class="invalid-feedback"
                     *ngIf="paymentForm.get('mobileNumber')?.invalid && paymentForm.get('mobileNumber')?.touched">
                  Please enter a valid mobile number.
                </div>
              </div>

              <!-- Voucher (collapsible) -->
              <div class="mb-4">
                <a class="text-decoration-none  text-primary"
                   data-bs-toggle="collapse" href="#voucherCollapse">
                  <i class="bi bi-ticket-perforated me-1"></i>
                  click to apply voucher
                </a>
                <div id="voucherCollapse" class="collapse mt-2">
                  <div class="input-group">
                    <input type="text" class="form-control rounded-2"
                         placeholder="Voucher code">
                    <button class="btn btn-outline-success rounded-2" type="button">Apply</button>
                  </div>
                </div>
              </div>

              <!-- Note -->
              <div class="alert alert-warning d-flex align-items-center py-2">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span class="small">
                  <strong>Note:</strong> Once seats are selected and paid for,
                  tickets are <b>non-refundable</b>.
                </span>
              </div>

              <!-- Consent -->
              <div class="form-check mb-4 small">
                <input class="form-check-input" type="checkbox"
                       formControlName="consent" id="consentCheck">
                <label class="form-check-label" for="consentCheck">
                  By proceeding, I consent to iabiri collecting and storing my information
                  in accordance with the
                  <a href="#" target="_blank">Privacy Policy</a> and
                  <a href="#" target="_blank">Terms & Conditions</a>.
                </label>
              </div>

              <!-- Submit -->
              <div class="d-flex justify-content-end">
                <button class="btn btn-success py-2 px-4 rounded-pill fs-6 fw-semibold shadow w-100"
                        [disabled]="isTimeExpired || paymentForm.invalid"
                        (click)="submitPayment()">
                  <i class="bi bi-lock-fill me-2"></i>
                  Pay Securely with {{ paymentForm.value.paymentMethod | titlecase }}
                </button>
              </div>

            </form>
          </div>
        </div>
        <!-- Button to toggle drawer -->

      </div>
    </div>
  </div>
</div>

<!-- Drawer for Bus Info -->
<p-drawer
  header="Bus Information"
  [(visible)]="busInfoVisible"
  position="bottom"
  class="p-2"
  [style]="{height: '700px'}">
  <app-checkout-bus-info></app-checkout-bus-info>

  <div class="mt-2">
    <button
    class="btn btn-success py-2 px-4 rounded-pill fs-6 fw-semibold shadow w-100"
    (click)="busInfoVisible = false"
    > Proceed to Pay </button>
  </div>
</p-drawer>
