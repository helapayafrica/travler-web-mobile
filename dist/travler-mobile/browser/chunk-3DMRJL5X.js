import{a as K}from"./chunk-SQM2R4FL.js";import{l as N}from"./chunk-NMHFSZUN.js";import{i as D,j as F,k as T,t as O,v as j}from"./chunk-GPQBVM7U.js";import{c as M}from"./chunk-35RUP4P6.js";import{Dc as y,Ic as s,Jc as d,Kc as C,Ob as v,Pb as n,Qb as a,Rb as u,Sc as B,Vb as I,Wb as h,Yc as P,_a as t,dc as x,ea as E,lb as b,qb as w,rc as i,sc as r,tc as g,uc as k,wb as S}from"./chunk-45NCVV7C.js";import{j as _}from"./chunk-TWZW5B45.js";var z=p=>({"text-success":p});function R(p,l){if(p&1&&(n(0,"div",23)(1,"div",24)(2,"h5",25),i(3),a(),n(4,"small",26),i(5),a(),u(6,"hr",27),n(7,"div")(8,"p",28),i(9),s(10,"translate"),a()(),n(11,"div",29)(12,"div",30)(13,"p",31),i(14),s(15,"translate"),a(),n(16,"p",32),i(17),a()(),n(18,"div",33)(19,"p",31),i(20),s(21,"translate"),a(),n(22,"p",32),i(23),a()()(),n(24,"div",29)(25,"div",34)(26,"small",26),i(27),s(28,"translate"),a(),u(29,"br")(30,"i",35),n(31,"span",36),i(32),a(),u(33,"br"),n(34,"span",37),i(35),a()(),n(36,"div",38)(37,"small",26),i(38),s(39,"translate"),a(),u(40,"br")(41,"i",39),n(42,"span",36),i(43),a(),u(44,"br"),n(45,"span",37),i(46),a()()()(),n(47,"div",19)(48,"div",40)(49,"p",41),u(50,"img",42),i(51),s(52,"translate"),a()()()()),p&2){let e=x();t(3),r(e.data.ticketDetail.onwardticket.company_name),t(2),r(e.data.ticketDetail.onwardticket.company_title),t(4),r(d(10,15,"busInfo.onwardTrip")),t(5),r(d(15,17,"busInfo.departure")),t(3),r(e.data.ticketDetail.onwardticket.departure_time||"--:--"),t(3),r(d(21,19,"busInfo.arrival")),t(3),r(e.data.ticketDetail.onwardticket.arrival_time||"--:--"),t(4),r(d(28,21,"busInfo.boardingPoint")),t(5),r(e.data.ticketDetail.onwardticket.source_city),t(3),r(e.data.ticketDetail.onwardticket.boardingPointname),t(3),r(d(39,23,"busInfo.droppingPoint")),t(5),r(e.data.ticketDetail.onwardticket.dest_city),t(3),r(e.data.ticketDetail.onwardticket.droppingPointname),t(5),k(" ",d(52,25,"busInfo.selectedSeats"),": ",e.getSelectedSeats()," ")}}function W(p,l){if(p&1&&(n(0,"div",43)(1,"div",24)(2,"h5",25),i(3),a(),n(4,"small",26),i(5),a(),u(6,"hr",27),n(7,"div")(8,"p",28),i(9),s(10,"translate"),a()(),n(11,"div",29)(12,"div",30)(13,"p",31),i(14),s(15,"translate"),a(),n(16,"p",32),i(17),a()(),n(18,"div",33)(19,"p",31),i(20),s(21,"translate"),a(),n(22,"p",32),i(23),a()()(),n(24,"div",29)(25,"div",34)(26,"small",26),i(27),s(28,"translate"),a(),u(29,"br")(30,"i",35),n(31,"span",36),i(32),a(),u(33,"br"),n(34,"span",44),i(35),a()(),n(36,"div",38)(37,"small",26),i(38),s(39,"translate"),a(),u(40,"br")(41,"i",39),n(42,"span",36),i(43),a(),u(44,"br"),n(45,"span",44),i(46),a()()()(),n(47,"div",19)(48,"div",40)(49,"p",41),u(50,"img",42),i(51),s(52,"translate"),a()()()()),p&2){let e=x();t(3),r(e.data.ticketDetail.returnticket.company_name),t(2),r(e.data.ticketDetail.returnticket.company_title),t(4),r(d(10,15,"busInfo.returnTrip")),t(5),r(d(15,17,"busInfo.departure")),t(3),r(e.data.ticketDetail.returnticket.departure_time||"--:--"),t(3),r(d(21,19,"busInfo.arrival")),t(3),r(e.data.ticketDetail.returnticket.arrival_time||"--:--"),t(4),r(d(28,21,"busInfo.boardingPoint")),t(5),r(e.data.ticketDetail.returnticket.source_city),t(3),r(e.data.ticketDetail.returnticket.boardingPointname),t(3),r(d(39,23,"busInfo.droppingPoint")),t(5),r(e.data.ticketDetail.returnticket.dest_city),t(3),r(e.data.ticketDetail.returnticket.droppingPointname),t(5),k(" ",d(52,25,"busInfo.selectedSeats"),": ",e.getSelectedSeats()," ")}}function J(p,l){if(p&1&&(I(0),n(1,"div",45)(2,"p",14),i(3),a(),n(4,"p",46),i(5),s(6,"number"),a()(),h()),p&2){let e=l.$implicit;t(3),r(e.total_number+" "+e.seat_type),t(2),g("KES ",d(6,2,e.total_price))}}function U(p,l){if(p&1&&(I(0),n(1,"div",45)(2,"p",14),i(3),a(),n(4,"p",46),i(5),s(6,"number"),a()(),h()),p&2){let e=l.$implicit;t(3),r(e.total_number+" "+e.seat_type),t(2),g("KES ",d(6,2,e.total_price))}}function V(p,l){if(p&1&&(n(0,"div")(1,"p",13),i(2),s(3,"translate"),a(),u(4,"hr",6),S(5,U,7,4,"ng-container",7),n(6,"div",8)(7,"p",9),i(8),s(9,"translate"),a(),n(10,"p",10),i(11),s(12,"number"),a()()()),p&2){let e=x();t(2),r(d(3,4,"busInfo.returnJourney")),t(3),v("ngForOf",e.returnSeatsSummary),t(3),r(d(9,6,"busInfo.returnFare")),t(3),g("KES ",d(12,8,e.data.ticketDetail.returnticket.total))}}function A(p,l){if(p&1&&(n(0,"small",26),i(1),a()),p&2){let e=x();t(),g(" (",e.cancellationInsuredService.protectedPassengersCount()," passengers) ")}}var $=class p{constructor(l,e){this.bookingService=l;this.cdr=e;this.getBooking(),this.cancellationInsuredService.loadCancellationProtection(),B(()=>{let c=this.cancellationInsuredService.total(),o=this.cancellationInsuredService.insuranceCost(),m=this.cancellationInsuredService.cancellationCost();this.cdr.markForCheck()})}data={};platformFee=0;discount=0;onwardSeatsSummary=[];returnSeatsSummary=[];cancellationInsuredService=E(K);getBooking(){return _(this,null,function*(){this.data=yield this.bookingService.getConfig("booking"),this.cancellationInsuredService.initializeBooking(this.data),this.seatSelected()})}get total(){return this.cancellationInsuredService.total()+this.platformFee-this.discount}get baseFare(){return this.cancellationInsuredService.baseTotal()}get totalInsurance(){return this.cancellationInsuredService.insuranceCost()}get cancellationProtectionCost(){return this.cancellationInsuredService.cancellationCost()}get isProtected(){return this.cancellationInsuredService.isCancellationProtection()}get passengerCount(){return this.cancellationInsuredService.passengerCount()}get protectedPassengersCount(){return this.cancellationInsuredService.protectedPassengersCount()}get protectionPercentage(){return this.cancellationInsuredService.protectionPercentage()}isObjectEmpty(l){return!l||Object.keys(l).length===0}getSelectedSeatsString(){let l=[],e=[];this.data?.ticketDetail?.onwardticket?.passenger?.length&&(l=this.data.ticketDetail.onwardticket.passenger.map(o=>o.seat_name)),this.data?.ticketDetail?.returnticket?.passenger?.length&&(e=this.data.ticketDetail.returnticket.passenger.map(o=>o.seat_name));let c=[...l,...e].sort((o,m)=>o.localeCompare(m,void 0,{numeric:!0}));return c.length?c.join(", "):"No seats selected"}getTotalPassengers(){let l=this.data?.ticketDetail?.onwardticket?.passenger?.length||0,e=this.data?.ticketDetail?.returnticket?.passenger?.length||0;return l+e}getSelectedSeats(){this.seatSelected();let l=this.data?.ticketDetail?.onwardticket?.passenger||[],e=this.data?.ticketDetail?.returnticket?.passenger||[],c="",o="";return l.length>0&&l.forEach(m=>{c+=m.seat_name+", "}),e.length>0&&e.forEach(m=>{o+=m.seat_name+", "}),c}seatSelected(){let l=this.data?.ticketDetail?.onwardticket?.passenger||[],e=this.data?.ticketDetail?.returnticket?.passenger||[];this.onwardSeatsSummary=this.getSeatTypeSummaryDetailed(l),this.returnSeatsSummary=this.getSeatTypeSummaryDetailed(e)}getSeatTypeSummaryDetailed(l){if(!l||l.length===0)return[];let e=l.reduce((o,m)=>{let f=m.seat_type;return o[f]||(o[f]={seat_type:f,total_number:0,total_price:0,total_flat_price:0,currency:m.currency||"KES",seat_names:[],seat_ids:[],average_price:0}),o[f].total_number+=1,o[f].total_price+=m.ticketPrice||0,o[f].total_flat_price+=m.flatTicketPrice||0,o[f].seat_names.push(m.seat_name),o[f].seat_ids.push(m.seat_id),o},{});return Object.values(e).map(o=>(o.average_price=o.total_number>0?Math.round(o.total_price/o.total_number*100)/100:0,o))}getInsuredSeatsString(){return this.cancellationInsuredService.insuredSeats().map(e=>e.seat_name).join(", ")}getUninsuredSeatsString(){let l=this.getSelectedSeatsString().split(", ").filter(o=>o.trim()),e=this.cancellationInsuredService.insuredSeats().map(o=>o.seat_name);return l.filter(o=>!e.includes(o)).join(", ")}getInsuredPassengerNames(){return this.cancellationInsuredService.getInsuredPassengerDetails().map(e=>e.name||`Passenger ${e.index+1}`).join(", ")}getUninsuredPassengerNames(){let l=this.cancellationInsuredService.passengerData(),c=this.cancellationInsuredService.getInsuredPassengerDetails().map(m=>m.id);return l.filter(m=>!c.includes(m.id)).map(m=>m.name||`Passenger ${m.index+1}`).join(", ")}getTotalWithoutExtras(){return this.cancellationInsuredService.total()}getFinalTotal(){return this.getTotalWithoutExtras()+this.platformFee-this.discount}getCostBreakdown(){return{baseFare:this.baseFare,insurance:this.totalInsurance,cancellation:this.cancellationProtectionCost,platform:this.platformFee,discount:this.discount,subtotal:this.getTotalWithoutExtras(),total:this.getFinalTotal()}}static \u0275fac=function(e){return new(e||p)(b(N),b(P))};static \u0275cmp=w({type:p,selectors:[["app-checkout-bus-info"]],decls:59,vars:48,consts:[["class","card shadow-sm rounded-3 mb-3","xmlns","http://www.w3.org/1999/html",4,"ngIf"],["class","card shadow-sm rounded-3 mb-3",4,"ngIf"],[1,"card","shadow-sm","rounded-3"],[1,"card-body","p-3"],[1,"text-danger","fw-bold"],[1,"fw-bold","mb-0","pb-0","text-muted","text-underline"],[1,"m-0","mb-2","text-muted"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],[1,"mb-1","fw-semibold"],[1,"fw-semibold","mb-1"],[4,"ngIf"],[1,"mt-3"],[1,"fw-bold","mb-1","p-0","text-muted","text-underline"],[1,"mb-1"],["class","text-muted",4,"ngIf"],[1,"fw-semibold","mb-1",3,"ngClass"],[1,"me-1","text-danger","text-decoration-line-through","fw-semibold"],[1,"fw-semibold","mb-1","text-success"],[1,"card-footer","border-0","bg-success-subtle"],[1,"col-12"],[1,"mb-1","fw-bold"],[1,"fw-bold","mb-1"],["xmlns","http://www.w3.org/1999/html",1,"card","shadow-sm","rounded-3","mb-3"],[1,"card-body"],[1,"text-danger","fw-bold","mb-1"],[1,"text-muted"],[1,"m-0","mb-1","text-muted"],[1,"fw-bold","text-dark","fs-6"],[1,"row","mt-3"],[1,"col-6"],[1,"mb-1","text-muted"],[1,"fw-bold","mb-0"],[1,"col-6","text-end"],[1,"col"],[1,"bi","bi-geo-alt-fill","me-2","text-danger"],[1,"fw-bold"],[1,"fw-normal","text-mutes"],[1,"col","text-end"],[1,"bi","bi-geo-alt-fill","me-2","text-success"],[1,"col-12","text-start"],[1,"mb-1","fw-bold","fs-6","text-success-emphasis","d-flex","align-items-baseline"],["alt","","height","20","src","assets/images/seat.png","width","20",1,"img-fluid","me-2"],[1,"card","shadow-sm","rounded-3","mb-3"],[1,"fw-normal","text-muted"],[1,"ms-3","d-flex","justify-content-between","mb-0"],[1,"fw-medium","mb-1","text-muted","small"]],template:function(e,c){e&1&&(S(0,R,53,27,"div",0)(1,W,53,27,"div",1),n(2,"div",2)(3,"div",3)(4,"h6",4),i(5),s(6,"translate"),a(),n(7,"p",5),i(8),s(9,"translate"),a(),u(10,"hr",6),S(11,J,7,4,"ng-container",7),n(12,"div",8)(13,"p",9),i(14),s(15,"translate"),a(),n(16,"p",10),i(17),s(18,"number"),a()(),S(19,V,13,10,"div",11),n(20,"div",12)(21,"p",13),i(22),s(23,"translate"),a()(),u(24,"hr",6),n(25,"div",8)(26,"p",14),i(27),s(28,"translate"),S(29,A,2,1,"small",15),a(),n(30,"p",16),i(31),s(32,"number"),a()(),n(33,"div",8)(34,"p",14),i(35),s(36,"translate"),a(),n(37,"p",10),i(38,"KES "),n(39,"span",17),i(40,"20"),a(),i(41),s(42,"number"),a()(),n(43,"div",8)(44,"p",14),i(45),s(46,"translate"),a(),n(47,"p",18),i(48),s(49,"number"),a()()(),n(50,"div",19)(51,"div",20)(52,"div",8)(53,"p",21),i(54),s(55,"translate"),a(),n(56,"p",22),i(57),s(58,"number"),a()()()()()),e&2&&(v("ngIf",c.data.ticketDetail.onwardticket),t(),v("ngIf",!c.isObjectEmpty(c.data==null||c.data.ticketDetail==null?null:c.data.ticketDetail.returnticket)),t(4),r(d(6,19,"busInfo.fareBreakup")),t(3),r(d(9,21,"busInfo.onwardJourney")),t(3),v("ngForOf",c.onwardSeatsSummary),t(3),r(d(15,23,"busInfo.onwardFare")),t(3),g("KES ",d(18,25,c.data.ticketDetail.onwardticket.total)),t(2),v("ngIf",!c.isObjectEmpty(c.data==null||c.data.ticketDetail==null?null:c.data.ticketDetail.returnticket)),t(3),r(d(23,27,"busInfo.additionalFees")),t(5),g("",d(28,29,"busInfo.insurance")," "),t(2),v("ngIf",c.cancellationInsuredService.protectedPassengersCount()>0),t(),v("ngClass",y(46,z,c.cancellationInsuredService.insuranceCost()>0)),t(),g(" KES ",d(32,31,c.cancellationInsuredService.insuranceCost())," "),t(4),r(d(36,33,"busInfo.platformFees")),t(6),r(d(42,35,c.platformFee)),t(4),r(d(46,37,"busInfo.discount")),t(3),g("KES ",d(49,39,c.discount)),t(6),r(d(55,41,"busInfo.totalPayable")),t(3),g("KES ",C(58,43,c.getFinalTotal(),"1.2-2")))},dependencies:[j,D,F,T,O,M],styles:[".card-img-top[_ngcontent-%COMP%]{height:200px;object-fit:cover}h6[_ngcontent-%COMP%]{font-weight:400!important}.card-header[_ngcontent-%COMP%]{background-image:linear-gradient(to right top,#000,#121212,#1e1e1e,#2a2a2a,#363636);color:#fff}.badge[_ngcontent-%COMP%]{background-color:#efefef;border:1px solid #ddd;color:#000;padding:.5rem}bi-calendar3.departure[_ngcontent-%COMP%]{color:var(--primary-color-500)}bi-calendar3.arrival[_ngcontent-%COMP%]{color:var(--secondary-color-500)}*[_ngcontent-%COMP%]{font-size:var(--font-size)}.text-decoration-line-through[_ngcontent-%COMP%]{text-decoration-thickness:2px!important;text-underline-offset:-3px!important}"]})};export{$ as a};
