import{a as X,b as Y,c as $,d as ee,e as te,f as ie,g as ne,h as re,i as oe}from"./chunk-P4NI4DP4.js";import{a as U}from"./chunk-HN423ZIP.js";import"./chunk-4KXBBMTD.js";import"./chunk-5MO6MPKA.js";import"./chunk-VBQ6VRJ5.js";import"./chunk-AY2LLG5T.js";import"./chunk-DNQPFKDS.js";import"./chunk-6THMQCJO.js";import"./chunk-BA5OYKA4.js";import"./chunk-JPC3RVDF.js";import"./chunk-MK3S6FXP.js";import"./chunk-IOPHG2KH.js";import"./chunk-H4ZN6NX2.js";import"./chunk-TJ7NUEOI.js";import"./chunk-VXBX3H4W.js";import{a as ae}from"./chunk-D5BAB7TU.js";import"./chunk-SQM2R4FL.js";import{a as G}from"./chunk-D3BB2YUO.js";import"./chunk-ZRTNA5AZ.js";import"./chunk-ZGVWO2O4.js";import{g as R,l as Q}from"./chunk-NMHFSZUN.js";import"./chunk-4QCEHMDE.js";import{a as J}from"./chunk-LF2IBCJR.js";import"./chunk-KLFOQ2RT.js";import{A as q,b as z,c as A,f as K,k as Z,n as H}from"./chunk-RAZRMRQX.js";import"./chunk-7UZYWCAJ.js";import"./chunk-6LBJZWJB.js";import{j as N,k as W,u as D}from"./chunk-GPQBVM7U.js";import{c as j}from"./chunk-35RUP4P6.js";import{Cc as L,Ic as d,Jc as u,Kc as T,Ob as p,Pb as t,Qb as n,Rb as h,Yb as k,Yc as O,_a as a,bc as g,dc as _,eb as M,ka as w,la as x,lb as b,pc as F,qb as P,qc as V,rc as c,sc as m,wb as v,wc as y,xc as f,yc as S,zc as E}from"./chunk-45NCVV7C.js";import{a as B,b as I,j as C}from"./chunk-TWZW5B45.js";var se=()=>({height:"auto",overflow:"auto"});function ce(l,r){l&1&&(t(0,"div",27),h(1,"app-shared-search"),n())}function pe(l,r){l&1&&(t(0,"div",28)(1,"div",29)(2,"span",30),c(3,"Loading..."),n()(),t(4,"p",31),c(5,"Searching for buses..."),n()())}function de(l,r){if(l&1&&h(0,"app-search-results",32),l&2){let e=_();p("isLoading",e.isLoading)("data",e.buses)}}function me(l,r){if(l&1){let e=k();t(0,"div",28)(1,"div",33),h(2,"i",34),t(3,"h4",35),c(4,"No Buses Found"),n(),t(5,"p",36),c(6,"We couldn't find any buses matching your criteria."),n(),t(7,"p-button",37),g("click",function(){w(e);let s=_();return x(s.toggleForm())}),n()()()}}function ue(l,r){l&1&&(t(0,"div",28)(1,"div",38),h(2,"i",39),t(3,"h4",35),c(4,"Ready to Search"),n(),t(5,"p",36),c(6,"Preparing your search results..."),n()()())}function he(l,r){if(l&1){let e=k();t(0,"label",40)(1,"div",41),h(2,"i"),t(3,"span",42),c(4),n()(),t(5,"input",43),S("ngModelChange",function(s){w(e);let o=_();return f(o.selectedDuration,s)||(o.selectedDuration=s),x(s)}),n()()}if(l&2){let e=r.$implicit,i=_();a(2),V(e.icon+" fs-4 me-3"),a(2),m(e.label),a(),p("value",e.value),y("ngModel",i.selectedDuration)}}function be(l,r){if(l&1){let e=k();t(0,"label",40)(1,"div",41),h(2,"i"),t(3,"span",44),c(4),n()(),t(5,"input",45),S("ngModelChange",function(s){let o=w(e).$implicit;return f(o.checked,s)||(o.checked=s),x(s)}),n()()}if(l&2){let e=r.$implicit;a(2),V(e.icon+" fs-4 me-3"),a(2),m(e.label),a(),y("ngModel",e.checked)}}var le=class l{constructor(r,e,i,s,o){this.backendService=r;this.bookingService=e;this.cdr=i;this.router=s;this.zone=o}buses=[];payload={};isLoading=!1;hasSearched=!1;ngOnInit(){return C(this,null,function*(){this.payload=yield this.getPayload(),this.payload&&Object.keys(this.payload).length>0?(this.hasSearched=!0,this.fetchBuses(this.payload)):(console.error("Payload is empty - no results will load"),this.hasSearched=!0,this.isLoading=!1);let r=this.getTextForBreadCrumb(),e="/search";this.items=[{text:r,routerLink:e}]})}getPayload(){return C(this,null,function*(){return yield this.bookingService.getPayload()})}fetchBuses(r){this.isLoading=!0,this.backendService.getTrips(r).subscribe({next:e=>{this.zone.run(()=>{this.buses=[...e?.data||[]],this.isLoading=!1,this.hasSearched=!0,this.cdr.detectChanges(),setTimeout(()=>this.cdr.detectChanges(),0)})},error:e=>{this.zone.run(()=>{this.buses=[],this.isLoading=!1,this.cdr.detectChanges()})}})}home={label:"Home"};items=[];isFormOpen=!1;filterVisible=!1;toggleForm(){this.isFormOpen=!this.isFormOpen}minValue=0;maxValue=1e4;options={floor:0,ceil:1e4,step:100,translate:r=>`KES ${r}`};durations=[{label:"3 hours",value:"3h",icon:"bi bi-clock"},{label:"3-5 hours",value:"3-5h",icon:"bi bi-hourglass-split"},{label:"5-7 hours",value:"5-7h",icon:"bi bi-stopwatch"},{label:"7+ hours",value:"7+h",icon:"bi bi-alarm"}];selectedDuration="3h";services=[{label:"Wi-Fi",checked:!1,icon:"bi bi-wifi"},{label:"TV",checked:!1,icon:"bi bi-tv"},{label:"Bed",checked:!1,icon:"bi bi-moon"},{label:"Meals",checked:!1,icon:"bi bi-egg-fried"}];getTextForBreadCrumb(){let r=this.bookingService.getConfig("source_name"),e=this.bookingService.getConfig("destination_name");return`${r} to ${e}`}getFilterChanges(r){return C(this,null,function*(){yield this.getPayload();let e=I(B({},this.payload),{boarding_points:r.boardingPoints,dropping_points:r.droppingPoints,bus_with_amenities:r.amenities,time_range:r.time_range,company_id:r.companyNames});console.log("New payload:",e),this.fetchBuses(e),this.cdr.detectChanges()})}hasData(){return this.buses&&this.buses.length>0}showEmptyState(){return this.hasSearched&&!this.isLoading&&(!this.buses||this.buses.length===0)}static \u0275fac=function(e){return new(e||l)(b(J),b(Q),b(O),b(R),b(M))};static \u0275cmp=P({type:l,selectors:[["app-view-search"]],decls:60,vars:52,consts:[[1,"search-section"],[1,"container","d-flex","flex-row","justify-content-between","align-items-center","w-100","mt-1"],["icon","bi bi-pencil","iconPos","left","label","Modify Trip","size","small","styleClass","modify-btn p-button-sm",3,"click"],[3,"filterChangeEmitter"],["class","py-2 container",4,"ngIf"],[1,"search-results-section",2,"min-height","60vh"],[1,"container","py-3"],[1,"row"],[1,"col-12"],["class","text-center py-5",4,"ngIf"],[3,"isLoading","data",4,"ngIf"],["size","small","position","bottom",3,"visibleChange","header","visible"],["value","0"],["value","1"],["value","2"],[1,"fs-6","fw-bold","mb-2","text-muted"],[1,"container","p-3"],[3,"valueChange","highValueChange","value","highValue","options"],[1,"d-flex","justify-content-between","mt-1","text-dark"],[1,"text-dark"],[1,"card-body"],[1,"fs-6","fw-bold","mb-4","text-muted"],["class","form-check d-flex align-items-center justify-content-between border-bottom py-2 w-100 mb-0",4,"ngFor","ngForOf"],[1,"row","p-3"],[1,"col-6"],["size","large","styleClass","p-button-outlined p-button-secondary p-button-rounded w-100",3,"click","label"],["size","large","styleClass","p-button-rounded w-100",3,"click","label"],[1,"py-2","container"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[3,"isLoading","data"],[1,"empty-state"],[1,"bi","bi-bus-front","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"text-muted"],["label","Modify Search","styleClass","p-button-outlined",3,"click"],[1,"initial-state"],[1,"bi","bi-search","fs-1","text-muted"],[1,"form-check","d-flex","align-items-center","justify-content-between","border-bottom","py-2","w-100","mb-0"],[1,"d-flex","align-items-center"],[1,"fw-semibold","mb-0"],["type","radio","name","duration",1,"form-check-input-lg",3,"ngModelChange","value","ngModel"],[1,"fw-semibold","fs-6","mb-0"],["type","checkbox",1,"form-check-input-lg",3,"ngModelChange","ngModel"]],template:function(e,i){e&1&&(t(0,"div")(1,"div",0)(2,"div",1)(3,"p-button",2),g("click",function(){return i.toggleForm()}),n(),t(4,"app-search-refine-filters",3),g("filterChangeEmitter",function(o){return i.getFilterChanges(o)}),n()(),v(5,ce,2,0,"div",4),n(),t(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8),v(10,pe,6,0,"div",9)(11,de,1,2,"app-search-results",10)(12,me,8,0,"div",9)(13,ue,7,0,"div",9),n()()()()(),t(14,"p-drawer",11),d(15,"translate"),S("visibleChange",function(o){return f(i.filterVisible,o)||(i.filterVisible=o),o}),t(16,"p-tabs",12)(17,"p-tablist")(18,"p-tab",12),c(19),d(20,"translate"),n(),t(21,"p-tab",13),c(22),d(23,"translate"),n(),t(24,"p-tab",14),c(25),d(26,"translate"),n()(),t(27,"p-tabpanels")(28,"p-tabpanel",12)(29,"h5",15),c(30),d(31,"translate"),n(),t(32,"div",16)(33,"ngx-slider",17),S("valueChange",function(o){return f(i.minValue,o)||(i.minValue=o),o})("highValueChange",function(o){return f(i.maxValue,o)||(i.maxValue=o),o}),n(),t(34,"div",18)(35,"span",19),c(36),d(37,"currency"),n(),t(38,"span",19),c(39),d(40,"currency"),n()()()(),t(41,"p-tabpanel",13)(42,"div",20)(43,"h5",21),c(44),d(45,"translate"),n(),v(46,he,6,5,"label",22),n()(),t(47,"p-tabpanel",14)(48,"div")(49,"h5",15),c(50),d(51,"translate"),n(),v(52,be,6,4,"label",22),n()()()(),t(53,"div",23)(54,"div",24)(55,"p-button",25),d(56,"translate"),g("click",function(){return i.filterVisible=!1}),n()(),t(57,"div",24)(58,"p-button",26),d(59,"translate"),g("click",function(){return i.filterVisible=!1}),n()()()()),e&2&&(a(5),p("ngIf",i.isFormOpen),a(5),p("ngIf",i.isLoading),a(),p("ngIf",!i.isLoading&&i.hasData()),a(),p("ngIf",i.showEmptyState()),a(),p("ngIf",!i.hasSearched&&!i.isLoading),a(),F(L(51,se)),p("header",E(u(15,27,"drawer.sortFilterTitle"))),y("visible",i.filterVisible),a(5),m(u(20,29,"tabs.priceRange")),a(3),m(u(23,31,"tabs.duration")),a(3),m(u(26,33,"tabs.services")),a(5),m(u(31,35,"priceRange.title")),a(3),y("value",i.minValue)("highValue",i.maxValue),p("options",i.options),a(3),m(T(37,37,i.minValue,"KES ")),a(3),m(T(40,40,i.maxValue,"KES ")),a(5),m(u(45,43,"duration.title")),a(2),p("ngForOf",i.durations),a(4),m(u(51,45,"services.title")),a(2),p("ngForOf",i.services),a(3),p("label",E(u(56,47,"actions.clear"))),a(3),p("label",E(u(59,49,"actions.save"))))},dependencies:[U,oe,W,G,ae,te,N,Y,X,ne,$,ee,q,A,z,H,K,Z,ie,re,D,j],styles:[".search-section[_ngcontent-%COMP%]{background-color:var(--background-color);color:#1f2f35!important}  .p-drawer-title{padding:.25rem 1rem;font-size:1.125rem;min-height:2rem}.active-crumb[_ngcontent-%COMP%]{color:var(--primary-color-600);text-decoration:underline}[_nghost-%COMP%]     .modify-btn{background:var(--primary-color-500);border:1px solid var(--primary-color-600);color:var(--primary-color-100)}[_nghost-%COMP%]     .modify-btn:hover{background:var(--primary-color-600);border:1px solid var(--primary-color-700);color:var(--primary-color-100)}[_nghost-%COMP%]     .modify-btn:active, [_nghost-%COMP%]     .modify-btn:focus{background:var(--primary-color-700);border:1px solid var(--primary-color-800);color:var(--primary-color-100);box-shadow:0 0 0 .2rem rgba(var(--primary-color-rgb),.5)}[_nghost-%COMP%]     .modify-btn:disabled{background:var(--primary-color-500);border:1px solid var(--primary-color-600);color:var(--primary-color-100);opacity:.6;cursor:not-allowed}"]})};export{le as SearchComponent};
