import{l as g}from"./chunk-NMHFSZUN.js";import{$ as u,Rc as o,ea as l,ua as r}from"./chunk-45NCVV7C.js";var S=class c{bookingService=l(g);insuredSeats=r(this.getStored());isCancellationProtection=r(this.getCancellationProtection());baseTotal=r(0);passengerCount=r(0);passengerData=r([]);insuranceCost=o(()=>{let e=this.insuredSeats(),s=this.passengerData(),t=new Set;return s.forEach(n=>{e.some(a=>a.seat_name===n.onwardSeat||a.seat_name===n.returnSeat)&&t.add(n.id||n.name||n.onwardSeat)}),t.size*50});cancellationCost=o(()=>this.isCancellationProtection()?this.passengerCount()*50:0);total=o(()=>this.baseTotal()+this.insuranceCost()+this.cancellationCost());protectedPassengersCount=o(()=>{let e=this.insuredSeats(),s=this.passengerData(),t=new Set;return s.forEach(n=>{e.some(a=>a.seat_name===n.onwardSeat||a.seat_name===n.returnSeat)&&t.add(n.id||n.name||n.onwardSeat)}),t.size});protectionPercentage=o(()=>{let e=this.passengerCount();return e>0?this.protectedPassengersCount()/e*100:0});totalProtectionCost=o(()=>this.insuranceCost()+this.cancellationCost());initializeBooking(e){let s=(e.ticketDetail.onwardticket?.total??0)+(e.ticketDetail.returnticket?.total??0),t=[],n=e.ticketDetail.onwardticket?.passenger||[],i=e.ticketDetail.returnticket?.passenger||[];n.forEach((a,d)=>{let h=i[d];t.push({id:`passenger_${d}`,name:a.name,onwardSeat:a.seat_name,returnSeat:h?.seat_name||null,index:d})}),this.baseTotal.set(s),this.passengerCount.set(t.length),this.passengerData.set(t)}updateInsuredSeats(e,s){let t=[...this.insuredSeats()];s?t.some(n=>n.seat_name===e)||t.push({seat_name:e}):t=t.filter(n=>n.seat_name!==e),this.bookingService.setConfig("insuredSeats",t),this.insuredSeats.set(t),this.insuredSeats.set([...t])}isSeatInsured(e){return this.insuredSeats().some(s=>s.seat_name===e)}isPassengerInsured(e){let t=this.passengerData()[e];return t?this.insuredSeats().some(i=>i.seat_name===t.onwardSeat||i.seat_name===t.returnSeat):!1}getInsuredPassengerDetails(){let e=this.passengerData(),s=this.insuredSeats();return e.filter(t=>s.some(n=>n.seat_name===t.onwardSeat||n.seat_name===t.returnSeat))}getStored(){return this.bookingService.getConfig("insuredSeats")||[]}update(e){this.insuredSeats.set(e),this.bookingService.setConfig("insuredSeats",e)}load(){let e=this.bookingService.getConfig("insuredSeats")||[];this.insuredSeats.set(e)}getCancellationProtection(){let e=this.bookingService.getConfig("cancellationProtection");return e||!1}updateCancellationProtection(e){this.isCancellationProtection.set(e),this.bookingService.setConfig("cancellationProtection",e)}loadCancellationProtection(){let e=this.getCancellationProtection();this.isCancellationProtection.set(e)}clearCancellationProtectionAndInsuredSeats(){this.bookingService.setConfig("insuredSeats",[]),this.bookingService.setConfig("cancellationProtection",!1),this.insuredSeats.set([]),this.isCancellationProtection.set(!1)}protectAllSeats(e){let s=e.map(t=>({seat_name:t}));this.insuredSeats.set(s),this.bookingService.setConfig("insuredSeats",s)}protectAllPassengers(){let e=this.passengerData(),s=[];e.forEach(t=>{t.onwardSeat&&s.push(t.onwardSeat),t.returnSeat&&s.push(t.returnSeat)}),this.protectAllSeats(s)}removeAllProtection(){this.insuredSeats.set([]),this.bookingService.setConfig("insuredSeats",[])}static \u0275fac=function(s){return new(s||c)};static \u0275prov=u({token:c,factory:c.\u0275fac,providedIn:"root"})};export{S as a};
